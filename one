db_name = "test_db"
spark.sql(f"CREATE DATABASE IF NOT EXISTS {db_name}")
print(f"Database {db_name} created or already exists.")

spark.sql(f"USE {db_name}")
table_name = "test_table"
spark.sql(f"""
    CREATE OR REPLACE TEMPORARY VIEW {table_name} AS
    SELECT 1 AS id, 'Alice' AS name
    UNION ALL
    SELECT 2, 'Bob'
    UNION ALL
    SELECT 3, 'Charlie'
""")
print(f"Table {table_name} created in database {db_name}.")

df = spark.sql(f"SELECT * FROM {table_name}")
df.show()

delta_table_path = "/mnt/delta/test_table_delta"
df.write.format("delta").mode("overwrite").save(delta_table_path)
print(f"Data written to Delta table at {delta_table_path}.")

delta_df = spark.read.format("delta").load(delta_table_path)
delta_df.show()

df_with_new_column = delta_df.withColumn("new_col", delta_df["id"] * 10)
df_with_new_column.show()

delta_table_path_2 = "/mnt/delta/test_table_delta_2"
df_with_new_column.write.format("delta").mode("overwrite").save(delta_table_path_2)
print(f"Transformed data written to new Delta table at {delta_table_path_2}.")

